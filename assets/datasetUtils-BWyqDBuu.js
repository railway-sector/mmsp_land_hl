import{V as O,cR as E,a2 as N,a3 as M,k8 as w,a5 as $,ci as R,j1 as L,cE as j}from"./index-YAG6QmBT.js";var C;let y=C=class extends O{constructor(e){super(e),this.variableName=null,this.dimensionName=null,this.values=[],this.isSlice=!1}clone(){return new C({variableName:this.variableName,dimensionName:this.dimensionName,values:E(this.values),isSlice:this.isSlice})}};N([M({type:String,json:{write:!0}})],y.prototype,"variableName",void 0),N([M({type:String,json:{write:!0}})],y.prototype,"dimensionName",void 0),N([M({type:w.array(w.oneOf([w.native(Number),w.array(w.native(Number))])),json:{write:!0}})],y.prototype,"values",void 0),N([M({type:Boolean,json:{write:!0}})],y.prototype,"isSlice",void 0),y=C=N([$("esri.layers.support.DimensionalDefinition")],y);function k(e,t,i){const r=t.shift();if(i.length===0){const n=[];i.push({sliceId:-1,multidimensionalDefinition:n})}const a=i.length;for(let n=0;n<a;n++){const s=i.shift().multidimensionalDefinition;r.values?.forEach(l=>{i.push({sliceId:-1,multidimensionalDefinition:[...s,{variableName:e,dimensionName:r.name,values:[l]}]})})}t.length&&k(e,t,i)}function H(e,t){const i=[];let r=0;return(t?e.variables.filter(a=>a.name.toLowerCase()===t.toLowerCase()):[...e.variables].sort((a,n)=>a.name>n.name?1:-1)).forEach(a=>{const n=[],s=[...a.dimensions].sort((l,m)=>l.name>m.name?-1:1);k(a.name,s,n),n.forEach(l=>{i.push({...l,sliceId:r++})})}),i}function K(e,t,i){let r=e;if(t&&(t=[...t].sort((a,n)=>a.dimensionName<n.dimensionName?-1:1)).forEach(({dimensionName:a,values:n,isSlice:s})=>{n.length&&(r=r.filter(l=>{const m=l.multidimensionalDefinition.find(u=>u.dimensionName===a);if(m==null)return!1;const o=m.values[0];return typeof o=="number"?typeof n[0]=="number"?n.includes(o):n.some(u=>u[0]<=o&&u[1]>=o):typeof n[0]=="number"?n.some(u=>o[0]<=u&&o[1]>=u):s?n.some(u=>u[0]===o[0]&&u[0]===o[1]):n.some(u=>u[0]>=o[0]&&u[0]<=o[1]||u[1]>=o[0]&&u[1]<=o[1]||u[0]<o[0]&&u[1]>o[1])}))}),r.length&&i?.start!=null&&i.end!=null){const a=i.start.getTime(),n=i.end.getTime(),s=r[0].multidimensionalDefinition.findIndex(l=>l.dimensionName==="StdTime");s>-1&&(r=r.filter(l=>{const m=l.multidimensionalDefinition[s].values[0];return a<=m&&n>=m}))}return r.map(a=>a.sliceId)}function F(e,t){return Array.isArray(e)?t[0]===t[1]?e[0]===t[0]||e[1]===t[0]:e[0]>=t[0]&&e[0]<=t[1]&&e[1]>=t[0]&&e[1]<=t[1]:e>=t[0]&&e<=t[1]}function _(e,t){return e[0]<=t[0]&&e[1]>=t[0]||e[0]<=t[1]&&e[1]>=t[1]||e[0]>=t[0]&&e[1]<=t[1]}function Y(e){return e.length===1?[e[0],e[0]]:[e[0],e[e.length-1]]}function I(e,t,i){if(!t?.subsetDefinitions?.length)return e;let r;if(i){const{variables:s}=t;if(s.length&&!s.includes(i))return null;const l=t.subsetDefinitions.find(m=>m.dimensionName===e.name&&m.variableName===i);if(!l?.values?.length)return e;r=Y(l.values)}else r=t.dimensions.find(({name:l})=>l===e.name)?.extent;const a=r;if(!a?.length)return e;const n=e.values.filter(s=>F(s,a));return{...e,extent:[...a],values:n}}function S(e,t,i){if(!t?.subsetDefinitions?.length)return!1;const{variables:r}=t;if(r.length&&e.some(({variableName:a})=>a&&!r.includes(a)))return!0;for(let a=0;a<e.length;a++){const n=e[a],s=t.subsetDefinitions.find(l=>(n.variableName===""||l.variableName===n.variableName)&&l.dimensionName===n.dimensionName);if(s?.values.length){const l=Y(s.values);if(!n.isSlice&&n.values.length===2&&!Array.isArray(n.values[0])&&n.values[0]!==n.values[1]&&i){if(!_(n.values,l))return!0}else if(n.values.some(m=>!F(m,l)))return!0}}return!1}function Q(e,t){if(e==null)return{isOutside:!1};const{geometry:i,timeExtent:r,multidimensionalDefinition:a}=t;let n=null;if(r!=null&&(n=V(e,r),n==null))return{isOutside:!0};const{areaOfInterest:s}=e;if(s&&i){const l=J(i);if(l&&!s.contains(l))return{isOutside:!0}}return a!=null&&a.length&&S(a,e,!0)?{isOutside:!0}:{isOutside:!1,intersection:{geometry:i,timeExtent:n,multidimensionalDefinition:a}}}function J(e){switch(e.type){case"point":return e;case"extent":return e.center;case"polygon":{const t=L(e);return t?j.fromJSON(t):null}}return null}function V(e,t){const i=e.dimensions.find(({name:s})=>s==="StdTime");if(i==null||t.start==null&&t.end==null)return t;t=t.clone();const{start:r,end:a}=t.toJSON(),n=r===a?[r]:r!=null&&a!=null?[r,a]:[r??a];return n.length===2&&i?.extent.length&&(n[0]=Math.max(n[0],i.extent[0]),n[1]=Math.min(n[1],i.extent[1]??i.extent[0]),n[1]<n[0])||S([new y({variableName:"",dimensionName:"StdTime",isSlice:n.length===1,values:n})],e,!0)?null:(t.start=new Date(n[0]),t.end=new Date(n[1]??n[0]),t)}function W(e){const{rasterInfo:t,multidimensionalSubset:i}=e,{multidimensionalInfo:r}=t;if(r==null)return null;let a=e.multidimensionalDefinition?.length?e.multidimensionalDefinition:U(t,{multidimensionalSubset:i});if(!a?.length)return null;if(a.some(s=>!s.dimensionName)){const{variableName:s}=a[0],l=U(t,{multidimensionalSubset:i,variableName:s});l?.forEach(m=>{const o=a?.find(({dimensionName:u})=>u===m.dimensionName);o?.values?.length&&(m.values=o.values,m.isSlice=o.isSlice)}),a=l}const{timeExtent:n}=e;if(a!=null&&n!=null&&(n.start!=null||n.end!=null)){a=a.map(h=>h.clone());const s=r.variables.find(({name:h})=>h===a[0].variableName)?.dimensions?.find(({name:h})=>h==="StdTime"),l=a.find(({dimensionName:h})=>h==="StdTime");if(!s||!l)return null;const{start:m,end:o}=n,u=m==null?null:m.getTime(),g=o==null?null:o.getTime(),f=u??g,d=g??u;if(s.values!=null){const h=s.values.filter(c=>{if(Array.isArray(c)){if(f===d)return c[0]<=f&&c[1]>=f;const b=c[0]<=f&&c[1]>f||c[0]<d&&c[1]>=d,v=c[0]>=f&&c[1]<=d||c[0]<f&&c[1]>d;return b||v}return f===d?c===f:c>=f&&c<=d});if(h.length){const c=h.sort((b,v)=>{const D=Array.isArray(b)?b[0]:b,p=Array.isArray(b)?b[1]:b,T=Array.isArray(v)?v[0]:v,x=Array.isArray(v)?v[1]:v;return f===d?D-T:Math.abs(p-d)-Math.abs(x-d)})[0];l.values=[c]}else a=null}else if(s.hasRegularIntervals&&s.extent){const[h,c]=s.extent;f>c||d<h?a=null:l.values=f===d?[f]:[Math.max(h,f),Math.min(c,d)]}}return a!=null&&S(a,i)?null:a}function z(e,t={}){const{multidimensionalInfo:i,keyProperties:r}=e;if(i==null)return null;const{variableName:a,multidimensionalSubset:n,multidimensionalDefinition:s}=t,l=s!=null?s[0]?.variableName:null,m=a||l||r?.DefaultVariable;let{variables:o}=i;return n?.variables?.length&&(o=o.filter(({name:u})=>n.variables.includes(u))),m?o.find(({name:u})=>u===m)??o[0]:o[0]}function U(e,t={}){const i=z(e,t);if(!i)return null;const r=[],{dimensions:a,name:n}=i;if(a.length===0)return[new y({variableName:n,dimensionName:"",values:[],isSlice:!0})];for(let s=0;s<a.length;s++){const l=I(a[s],t.multidimensionalSubset,n);if(!l)return null;const{values:m,extent:o}=l;let u=m?.[0]??o?.[0];l.name.toLowerCase()==="stdz"&&!l.hasRanges&&o&&Math.abs(o[1])<=Math.abs(o[0])&&(u=m?.length?m[m.length-1]:o[1]),r.push(new y({variableName:n,dimensionName:l.name,values:[u],isSlice:!t.useRangeForRangedDimensionInfo||!!l.hasRanges}))}return r}function X(e){return!!e?.length&&e.some(t=>{if(t.values==null)return!0;const i=t.values.length;return i===0||i>1||!t.isSlice&&Array.isArray(t.values[0])})}function Z(e,t){if(t==null||e==null)return null;let i=t.variables.map(r=>({...r}));return e?.variables?.length&&(i=i.filter(({name:r})=>e.variables.includes(r)),i.forEach(r=>{r.dimensions=r.dimensions.map(a=>I(a,e,r.name)).filter(R)})),i}function B(e,t){const{values:i}=t;if(i?.length){const l=Array.isArray(i[0]),m=Array.isArray(e);return l!==m?-1:l&&m?i.findIndex(o=>o[0]===e[0]&&o[1]===e[1]):i.indexOf(e)}const{extent:r}=t;if(Array.isArray(e)||!r||e<r[0]||e>r[1])return-1;const a=t.interval||1;if(t.unit!=="ISO8601")return Math.round((e-r[0])/a);const n=r[0];let s=-1;switch(t.intervalUnit?.toLowerCase()||"days"){case"seconds":s=Math.round((e-n)/1e3/a);break;case"minutes":s=Math.round((e-n)/6e4/a);break;case"hours":s=Math.round((e-n)/36e5/a);break;case"days":s=Math.round((e-n)/864e5/a);break;case"months":{const l=new Date(e).getUTCFullYear()-new Date(n).getUTCFullYear(),m=new Date(n).getUTCMonth(),o=new Date(e).getUTCMonth();s=l===0?o-m:o+11-m+12*(l-1)}break;case"years":s=Math.round((new Date(e).getUTCFullYear()-new Date(n).getUTCFullYear())/a);break;case"decades":s=Math.round((new Date(e).getUTCFullYear()-new Date(n).getUTCFullYear())/10/a)}return s}function A(e){let t=e.values?.length;if(t)return t;const{extent:i,unit:r}=e,a=e.interval||1,n=i?i[1]-i[0]:0;if(r!=="ISO8601")return Math.round(n/a);switch(e.intervalUnit?.toLowerCase()??"seconds"){case"seconds":t=Math.round(n/1e3/a);break;case"minutes":t=Math.round(n/6e4/a);break;case"hours":t=Math.round(n/36e5/a);break;case"days":t=Math.round(n/864e5/a);break;case"months":if(i){const s=new Date(i[1]).getUTCFullYear()-new Date(i[0]).getUTCFullYear(),l=new Date(i[0]).getUTCMonth(),m=new Date(i[1]).getUTCMonth();t=s===0?m-l+1:m+11-l+12*(s-1)+1}else t=0;break;case"years":t=i?Math.round((new Date(i[1]).getUTCFullYear()-new Date(i[0]).getUTCFullYear())/a):0;break;case"decades":t=i?Math.round((new Date(i[1]).getUTCFullYear()-new Date(i[0]).getUTCFullYear())/10/a):0;break;default:t=0}return t}function ee(e){if(e.extent?.length!==2||!e.interval)return[];const{extent:[t,i],interval:r}=e;if(e.unit==="ISO8601"){const n=e.intervalUnit?.toLowerCase()??"days";return["decades","years","months","days","hours","minutes","seconds"].includes(n)?P(t,i,r,n):[]}const a=Math.round((i-t)/r);return Array.from({length:a},(n,s)=>s===a-1?i:t+s*r)}function P(e,t,i,r){const a=[];let n=e;const s=new Date(e);for(;n<=t;)switch(a.push(n),r){case"decades":s.setUTCFullYear(s.getUTCFullYear()+10*i),n=s.getTime();break;case"years":s.setUTCFullYear(s.getUTCFullYear()+i),n=s.getTime();break;case"months":s.setUTCMonth(s.getUTCMonth()+i),n=s.getTime();break;case"days":n+=864e5*i;break;case"hours":n+=36e5*i;break;case"minutes":n+=6e4*i;break;case"seconds":n+=1e3*i}return a.length===1?a[1]=t:a[a.length-1]=t,a}function ne(e,t){let i=0;const r=e[0].variableName,a=[...t.variables].sort((n,s)=>n.name>s.name?1:-1);for(let n=0;n<a.length;n++){const s=a[n],l=[...s.dimensions].sort((u,g)=>u.name>g.name?-1:1);if(s.name!==r){i+=l.map(u=>A(u)).reduce((u,g)=>u*g);continue}const m=l.map(u=>A(u)),o=l.length;for(let u=0;u<o;u++){const g=e.find(d=>d.dimensionName===l[u].name);if(g==null)return null;const f=B(g.values[0],l[u]);if(f===-1)return null;m.shift(),i+=u===o-1?f:f*m.reduce((d,h)=>d*h)}break}return i}function te(e){return Math.round(24*(e-25569)*3600*1e3)}function q(e){return e?.datasetFormat==="Function"}function ae(e){return q(e)?e.primaryRasters.rasters:[e]}function ie(e,t,i,r){const{x:a,y:n}=t,{x:s,y:l}=i,{xmin:m,xmax:o,ymin:u,ymax:g}=e,{width:f,height:d}=e,h=f/s,c=d/l,b=Math.min(h,c),v=b<=1?0:Math.min(.1,b/100),D=Math.floor((m-a)/s+v),p=Math.floor((n-g)/l+v),T=Math.floor((o-a)/s-v),x=Math.floor((n-u)/l-v);return{ul:{x:D,y:p},width:r>0&&h<.1?0:T-D+1,height:r>0&&c<.1?0:x-p+1}}export{ne as C,Z as D,te as U,K as a,U as b,S as c,Q as f,W as g,ie as n,y as p,ae as r,H as s,q as t,z as v,ee as w,X as y};
